<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mini GeoGuessr Gratuit</title>
<style>
  body { margin:0; font-family:Arial, sans-serif; overflow:hidden; }
  #topbar {
    position:absolute; top:10px; left:10px; z-index:10;
    background:white; padding:10px 15px; border-radius:8px;
    box-shadow:0 0 5px rgba(0,0,0,0.4);
  }
  #map {
    position:absolute; bottom:10px; right:10px; width:250px; height:250px;
    z-index:10; border:2px solid #333; border-radius:6px;
    filter:blur(2px) brightness(0.7); transition:0.4s;
  }
  #map:hover { filter:none; }
  #guessBtn, #nextBtn {
    margin-top:5px; width:100%; padding:8px; font-size:16px;
    cursor:pointer; border-radius:6px;
  }
  iframe { width:100vw; height:100vh; border:none; }
  #scoreboard {
    position:absolute; top:10px; right:10px; z-index:10;
    background:white; padding:10px; border-radius:8px;
    box-shadow:0 0 5px rgba(0,0,0,0.4);
  }
</style>
</head>
<body>

<div id="topbar">
  <label>Ville :</label>
  <select id="city-select">
    <option value="paris">Paris</option>
    <option value="lyon">Lyon</option>
    <option value="marseille">Marseille</option>
    <option value="strasbourg">Strasbourg</option>
  </select>
  <button id="guessBtn" onclick="guess()">üìç Deviner</button>
  <button id="nextBtn" style="display:none;" onclick="startRound()">‚ü≥ Prochaine manche</button>
</div>

<div id="scoreboard">Score : <span id="score">0</span></div>

<iframe id="sv" allowfullscreen></iframe>
<iframe id="map" src="https://www.openstreetmap.org/export/embed.html?bbox=-5.2,41,9.6,51.2&layer=mapnik"></iframe>

<script>
// ----- 1. Base de points Street View garantis -----
const cityPoints = {
  paris: [
    {lat:48.8566,lng:2.3522}, {lat:48.8606,lng:2.3376},
    {lat:48.8738,lng:2.2950}, {lat:48.8867,lng:2.3431},
    {lat:48.8515,lng:2.3470}
  ],
  lyon: [
    {lat:45.7640,lng:4.8357}, {lat:45.7578,lng:4.8320},
    {lat:45.7600,lng:4.8280}, {lat:45.7680,lng:4.8350},
    {lat:45.7625,lng:4.8410}
  ],
  marseille: [
    {lat:43.2965,lng:5.3698}, {lat:43.3000,lng:5.3800},
    {lat:43.2920,lng:5.3700}, {lat:43.2850,lng:5.3710},
    {lat:43.2980,lng:5.3670}
  ],
  strasbourg: [
    {lat:48.5734,lng:7.7521}, {lat:48.5760,lng:7.7540},
    {lat:48.5700,lng:7.7600}, {lat:48.5745,lng:7.7400},
    {lat:48.5690,lng:7.7550}
  ]
};

// ----- 2. Variables de jeu -----
let answer = {lat:0,lng:0};
let score = 0;

// Tirer un point au hasard
function getRandomPoint(points){ 
  return points[Math.floor(Math.random()*points.length)]; 
}

// Distance en km
function distance(lat1,lng1,lat2,lng2){
  const toRad = x => x * Math.PI/180;
  const R = 6371;
  const dLat = toRad(lat2-lat1);
  const dLon = toRad(lng2-lng1);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

// ----- 3. Lancer une manche -----
function startRound(){  
  const city = document.getElementById("city-select").value;
  const point = getRandomPoint(cityPoints[city]);
  answer = point;

  document.getElementById("sv").src = 
    `https://www.google.com/maps?q&layer=c&cbll=${point.lat},${point.lng}&cbp=12,0,0,0,0&output=svembed`;

  document.getElementById("guessBtn").style.display = "inline-block";
  document.getElementById("nextBtn").style.display = "none";
}

// ----- 4. Fonction deviner sur la carte -----
function guess(){
  alert("Clique sur la carte (OpenStreetMap) pour deviner.");

  document.getElementById("map").addEventListener("click", function(e){
      const guessLat = 51.2 - (e.offsetY/250)*(51.2-41);
      const guessLng = -5.2 + (e.offsetX/250)*(9.6+5.2);

      const d = Math.round(distance(answer.lat, answer.lng, guessLat, guessLng));
      const pts = Math.max(0,5000 - d*80);
      score += pts;
      
      document.getElementById("score").innerText = score;

      alert(`üö© Distance : ${d} km\nüéØ Points gagn√©s : ${pts}`);

      document.getElementById("nextBtn").style.display = "inline-block";
      document.getElementById("guessBtn").style.display = "none";
  }, {once:true});
}

// ----- 5. D√©marrage automatique -----
startRound();
</script>

</body>
</html>
